> This is intended for the CDC as part of the **[Detecting Emerging Threats in Injury and Violence Using Network Science](https://www.freelancer.com/contest/Detecting-Emerging-Threats-in-Injury-and-Violence-Using-Network-Science-2019614)**

## Executive Summary
Adverse childhood experiences (ACEs) are traumatic events that occur to an individual before the age of 18. These experiences include domestic violence, mental illness, physical neglect, among others. According to the Centers of Disease Control, "Adverse childhood experiences can have a tremendous impact on future violence victimization and perpetration, and lifelong health and opportunity". The COVID-19 pandemic has accelerated the negative impacts of ACEs necessitating novel methods of identifying and intervening against them. While ACEs may be broad in characterization, distinguishing these events from normal childhood experiences has not been thoroughly explored. This distinction is necessary if intervention protocols are to be developed and implemented. 

In our solution, we provide a novel prediction algorithm that can take input text depicting a childhood experience and output whether or not this experience is speaking about an ACE (in a positive or negative light). The prediction model is trained on Reddit post titles from subreddits focused on childhood experiences. This prediction model has a 90% accuracy with both an internal Reddit test set and an external Twitter dataset. We combine the outputs of this prediction algorithm with a network constructed from Twitter users. Based on the attributes of the nodes (each Twitter user) in this network and their adjacent neighbors, we will be able to identify hotspots of ACEs. Each node has four attributes: User ID, Username, Tweet Sentiment, and ACE Probability. 

Using all this information, we will be able to identify if a user who experienced an adverse event has a community providing proper support. Using our prediction model in conjunction with social network analysis, we will be able to relay important information to professionals about an individual's experiences and community. We are able to identify cliques which have supportive individuals, who provide a positive influence to those who have experienced ACEs. In a similar light, we are able to determine locations in need of intervention where individuals who are negatively speaking about their experiences are not getting proper support. Using measures such as clustering coefficients and closeness centrality, we are able to determine the most influential individuals within a subnetwork. By analyzing the tweet content of these influential individuals, we can determine if a particular subnetwork is positively overcoming ACEs or if they need help.

Moving forward, there are two main venues of improvement. First, the prediction model's accuracy can be improved. Larger training data along with more clean input data can better our model's performance. On the network side, adding more parameters to each node can provide professionals with more markers to measure ACEs in social media. Lastly, further expanding the size of the network will greatly deepen our understanding of the ways in which ACEs are communicated and addressed across dispersed groups in Twitter.

## 1 Topic Area 
The focus of our solution is on Adverse Childhood Events (ACEs), specifically identification of ACEs on social media like Reddit and Twitter. Following this identification, we will use constructed networks to determine intervention points and pathways. ACEs have been shown to have long-term effects on individuals, resulting in both mental and physical trauma. With the advent of the COVID-19 pandemic and the following economic strife within the United States of America, there has been an uptick of ACEs. This necessitates the need for identification of ACE hotspots and protocols for intervention. Our solution will aid health professionals in understanding the communication of ACEs in social media and the various responses to that communication. Based on our algorithms, professionals can take steps to intervene where necessary.

## 2 Data Sources

### 2.1 Reddit Datasets
Using **[Pushshift.io Reddit API](https://github.com/pushshift/api)**, reddit data and metadata can be scraped real-time [[1]](#1). Using this API, we scraped through two subreddits: r/raisedbynarcissists and r/internetparents. r/raisedbynarcissists is a support group for people raised by abusive parents and hence contains a lot of posts detailing ACEs. r/internetparents is a subreddit focusing on general childhood events and experiences. The reasons as to why these two subreddits were chosen will be explained later in the methods. Within these subreddits, all available posts between 1-1-2020 and 12-25-2021 were aggregated and compiled into two data files, one for each subreddit. Within each data file, multiple attributes of each post were captured, including title of post, body of post, number of comments, upvotes, etc.

The aggregated Reddit data can be easily recreated by the CDC using a Python script (provided in the Github) and the Pushshift API. Compilation of all posts into a data file takes around four to five hours on an Apple M1 Max.

### 2.2 Twitter 
For acquiring Twitter information, we used two tools for different purposes. We used the **[Twitter Intelligence Tool (TWINT)](https://github.com/twintproject/twint)** to identify tweets from the mass public that fit our search criteria which will be explained later[[2]](#2). We also used it to get all the tweets from a user of interest. We used **[Tweepy](https://github.com/tweepy/tweepy)**, a python wrapper for Twitter’s API, to get information about the followers of a user of interest. For future work, it would be more efficient to do both on Tweepy [[3]](#3). We found out in the later stages of our development that the initial tool we used, TWINT, was not maintained properly and therefore unstable due to changes with Twitter’s source code. However, Tweepy remains current and is built directly on Twitter’s API which ensures that it will remain stable for the foreseeable future. 

This Twitter data can be collected by the CDC relatively easily as the api’s we used are all published under the MIT License. The relevant notebooks have been published on our github to utilize these tools. However, a Twitter developer api key is required to utilize the Tweepy API. The actual scraping is faster and done in under 3 minutes for most single search requests using a Macbook 2015 Pro. 

## 3 Hypothesis
Network analysis, specifically social network analysis, can help characterize different features of a vast ecosystem based on many metrics. By simplifying something as complex and intricate as social media into a graph where only two or three variables are being studied, professionals can identify important information that could yield future strategies. One reason ACEs persist is due to lack of communication and support. Identifying if these facets are available to an individual is crucial for addressing the long-term impacts of ACEs. By performing network analysis on social media profiles, we will be able to see if proper support structures and communication venues are available to individuals who desperately need it. Health threats can be mitigated before there are lasting effects. These methods have been used in social sharing systems, link prediction, marketing strategies etc. However, as far as we know, this is the only investigation into using social network analysis to intervene on ACEs. Using our prediction model in conjunction with social network analysis, we will be able to relay important information to professionals about an individual's experiences and community.

## 4 Methods 
For all referenced pictures, please refer to our attached full paper. 
The algorithm we have built is two-fold. The first part of the algorithm is a natural language based prediction model trained on Reddit post titles to predict the presence of an ACE based on language used by the user. The second part of this algorithm is the construction of a graph network to visualize Twitter users and the presence of ACEs among these users. Within this graph network, each node is a twitter user designated by a unique Twitter id. Each node will have four attributes: the prediction model's results for the user's Twitter tweets, a pretrained sentiment analysis of the tweet, the username of the individual, and lastly the hashed id. With these attributes, the localization and spread of ACEs across different communities can be visualized and proper intervention steps can be taken. 

### 4.1 Prediction Model
To determine the presence of an ACE, we built a prediction model trained on textual data. This prediction model, given some input text, can output a probability of how likely this text contains references to an ACE. If the probability is above 0.5, the model will classify the input as an ACE. To build this model, a supervised architecture was necessary and hence Twitter data couldn't be used for training. Twitter data is largely unlabeled and would require massive effort to manually label. To overcome this, training data was aggregated from Reddit. r/raisedbynarcissists is a subreddit focused on individuals giving accounts of childhood trauma and abuse, where the title often contains enough information to understand the overall experience. These titles are similar in length to tweets and hence can be used as appropriate training data for our prediction model. While r/raisedbynarcissists would be our positive class (Class 1) for the presence of ACE, a negative class was required which did not exhibit ACEs within the text. r/internetparents is a subreddit that is similarly structured to r/raisedbynarcissists but the posts are about general childhood memories. These titles would comprise our negative class (Class 0).

#### 4.1.1 Data Preprocessing
Prior to processing by the machine learning models, the Reddit post titles, from both subreddits, were cleaned via the python’s NLTK NLP library as well as the regex python libraries. The NLP pipeline contains several features applied to clean the text including expanding abbreviations, removing special characters, among others. Because our prediction model will be used to predict ACE presence within tweets (which can be up to 240 characters), only titles with greater than 10 words were used within the training data. This is because larger titles correspond better with Twitter tweets. Sentiment analysis on each of the Reddit titles was also calculated using a pretrained rule-based analysis model called VADER. This model outputs a number that ranges between -1 to 1 where a negative number corresponds to a negative sentiment, and vice versa for positive sentiment. To summarize, titles from r/raisedbynarcissists were designated as Class 1 and titles from r/internetparents were designated as Class 0.

#### 4.1.2 Word Embedding
To capture contextual meaning of words within the training data, word embeddings were used. Word embeddings can capture the semantic meaning of words by converting them into numeric vectors. Vectors of semantically similar words would be closer to each other. The word vectors used to create the word embedding matrix were extracted from GloVe (Global Vectors for Word Representation). GloVe is an unsupervised learning algorithm for obtaining vector representations for words. Training is performed on aggregated global word-word co-occurrence statistics from a corpus, and the resulting representations showcase interesting linear substructures of the word vector space. Each GloVe vector has 300 dimensions. 96% of the vocabulary (unique words within the training dataset) were captured through GloVe embeddings.

#### 4.1.3 Convolutional Neural Network
Convolutional neural networks have been applied successfully in many previous image processing and text processing studies. CNNs work by modeling hierarchical complicated patterns using smaller and simpler patterns. Convolutional layers along with the max-pooling layer allows models to learn useful word representations while also making the model more computationally efficient. Data was split into 0.8/0.2 training/testing. High-level NN **[API Keras](https://keras.io/)** using **[Tensorflow](https://github.com/tensorflow/tensorflow)** as a backend was used to set up the neural network structures [[4]](#4), [[5]](#5).

#### 4.1.4 Reddit Post Titles Clustering
Further analysis was done on Reddit post titles from r/raisedbynarcissists. After converting these titles to vectors, a PCA was performed for dimensionality reduction. 200 components were captured accounting for 95% of the variation within the data. After performing clustering using K-Means on these components, six unique clusters were identified. The significance of this work will be discussed in 5.1.2. 

### 4.2 Network
#### 4.2.1 Twitter API Extraction
To determine the root node of the network, we used a keyword search of the general public’s tweets. These words were selected based on the analysis we conducted on reddit as shown by *Figure 1* . As such the primary keyword search that was used was *'abuse OR hurt OR hit OR cry OR parents'*. Once this was done, we looked through the returned tweets and identified one that resembled an ACE event. 

Initially we attempted to target the replies of the original tweet but we found this to produce limited results. Since a significant portion of these tweets didn’t have substantive replies, we pivoted to looking into the followers of the user who made the tweet. We wanted to explore this method before building a fully automated system, so the first network was built relying heavily on manual work to transfer information between the different steps. Additionally, we limited the scope of the network to a 3 layer network with 5 children nodes allowed for the root node and a maximum of three children allowed for the nodes in layer two. 

Once we identified a child node, we used the same keyword search to parse through the user’s tweets to identify any potential ACE event. If an event was identified, we repeated the process and looked at their followers. If no such event was identified, we moved onto the next follower. Overall, this process led to us gaining a stronger domain knowledge in this area and understanding trends. However, such a process could not be implemented at scale since it relied heavily on manual steps to parse and select followers/tweets for the next step. Thus we began developing a more automated pipeline. 

In terms of the semi-automated pipeline, we used a more restrictive search term, *'abuse OR hurt OR hit OR cry AND parents'*,  and this allowed for us to simply pick the most recent tweet by the user. Thus we were able to eliminate a significant portion of manual part of the data scraping by focusing on specifically ACE events including parents. With the semi-automated pipeline, we were able to significantly scale up the number of tweets analyzed. The rate limiting factor became the Twitter API and getting all the followers to a specific user. For comparison, the first network shown in *Figure 2* took 3 hours to build using the manual method while the network shown in *Figure 3* took less than 20 minutes to build using the semi-automated pipeline. 

#### 4.2.2 networkx
To depict the connections between Twitter users who are likely to have experienced ACEs, it was crucial to create a graph network detailing the connections. The python library networkx was used for this purpose. A directional graph was created where each node is a Twitter user. Each edge connects a Twitter user with their follower, in the direction of their arrow. For example, if Node 1 has an edge pointed to Node 2, Node 2 is a follower of Node 1. Each node has four attributes: User ID, Username, Tweet Sentiment, and ACE Probability. The first two measures are extracted using Twitter APIs. The last two measures are calculated using the modules built and trained for prediction. The label for each node within the graph is a hashed id to improve readability. We conducted perfect hashing and this was calculated using the python package perfect-hash. The size for each node depicts the likelihood this individual has experienced an ACE based on a pertinent tweet and the prediction model. Nodes that are larger are likely to have a tweet expressing ACEs while nodes that are smaller aren't. The color of each node represents the sentiment of the user's tweet, be it positive or negative. A more blue node represents that the user's tweet is positive. A red node represents a tweet with a negative sentiment. For example, a large blue node would indicate a user who has positively tweeted about an ACE.

## 5 Results 
### 5.1 Prediction Model
#### 5.1.1 Convolutional Neural Network
Our prediction model had an average accuracy of 90% and an average AUROC of 90% on Reddit post titles within an internal testing set. We also tested our model on an external Twitter dataset which we manually labeled. On this dataset, our model had a 90% accuracy with a 96% AUC. These results can be replicated by running the accompanying Python notebooks with appropriate data files. While this network has a high accuracy there are a couple caveats. Some words like "hit" may be used for the model as a signal for abuse but "hit" can be used in different contexts (for example, "hit me up"). With more complex models, this type of contextual learning can be improved. Another issue is the presence of fake posts. Media sources like Twitter and Reddit often have individuals “trolling”, or making up a fake story for attention. Our model will predict these fake experiences as an ACE and hence our network will depict the user as having an ACE. However, this would be misleading as intervention steps are not necessary in this scenario.

#### 5.1.2 Reddit Post Titles Clustering
In the analysis performed in 4.1.4, six clusters were identified to group Reddit post titles. Each of these clusters had unique features within them. One cluster contained titles that were specific to emotional responses while another cluster contained titles that were specific to physical responses. Another cluster contained titles which had some temporal information within it. As shown by *Figure 1*, we identified certain keywords that were frequently used in these subreddits and analysis showed these had a significant impact on the cluster designation. While these clusters and methodology aren't necessary for network functionality, the protocol can be used to filter different ACEs based on certain criteria. These clusters can be generated on a selection of post titles using the accompanying notebook.

**(a)**
<img src="https://github.com/PrathicSundararajan/threat_example/blob/9df541a08ebc862116ffb6f34b8d65e975d227f6/assets/unique_words.png" width = "400" height = "400" />

**(b)**
<img src="https://github.com/PrathicSundararajan/threat_example/blob/3689f3125e083f465f1655a01c11c47fc0925c67/assets/clusters.png" width = "800" height = "400" />

**Figure 1: (a)** Most frequent words used in training data from r/raisedbynarcissists **(b)** Most common unique words in training data from r/raisedbynarcissists filtered to only return a negative sentiment value.

### 5.2 Network
Using networkx, the prediction models, and data extracted from Twitter, graph networks were built to map out the connections between individuals who may have experienced ACEs. *Figure 2* and *Figure 3* show two networks of different sizes. As stated before, the size for each node depicts the likelihood this individual has experienced an ACE based on a pertinent tweet and the prediction model. Nodes that are larger are likely to have a tweet pertinent to ACEs while nodes that are smaller aren't. The color of each node represents the sentiment of the user's tweet, be it positive or negative. A more blue node represents that the user's tweet is positive. A red node represents a tweet with a negative sentiment. 

*Figure 2* is a network of 18 individuals where our prediction algorithm found 2 individuals where negative for ACEs and 16 individuals were positive for ACEs. Because our algorithm looks for tweets relating to ACEs, these numbers are consistent with our expectations. 5 of the 18 individuals had tweets with a positive sentiment.

<img src="https://github.com/PrathicSundararajan/threat_example/blob/9df541a08ebc862116ffb6f34b8d65e975d227f6/assets/small_network.png" width="500" height="500"/>

**Figure 2:** Graph network depicting 18 individuals on Twitter based on ACE experience

Using the colors and sizes of the node, we are able to see that Node 1 is an individual who is speaking about an ACE positively. This may be an indication that this Node might be providing support to their connections. Large red nodes like Node 0 may be getting a positive influence from Node 1. Large red nodes not having large blue node connections may be a possible intervention location as proper support is not available. Identifying the number of large blue nodes in a red node's connections can be a measure of how much positive support they have around them. 

Additionally one of the benefits of building this network using the more manual pipeline was that it allowed the time to build more domain knowledge. We found that clustered groups often had similar experiences and outcomes. Thus once a larger network is built out, different tight clusters can be analyzed to understand what factors may contribute to the ACE occurring and how it might affect an individual in the long run. 

<img src="https://github.com/PrathicSundararajan/threat_example/blob/3477ab3350279c9b17763ad17e57864cf2c9492d/assets/large_network.png" width="750" height="800"/>
**Figure 3:** Graph network depicting 41 individuals on Twitter based on ACE experience

*Figure 3* depicts a network that was generated by the semi-automated pipeline which had allowed us to expand our network. Due to time constraints, we were limited to only 41 total individuals to make up our network. However, this more populated network allowed us to calculate the clustering coefficient of these nodes to provide some analysis. We found that the only non-zero coefficients from nodes in our network were 0, 4, and 5. Since only nodes 0-6 have fully populated children nodes, only those clustering coefficient values should be taken into account. With this in mind, it is understandable that Node 0 is non-zero since it is the root node and serves as a connection between all the nodes. 

Analyzing 4 and 5 provides more important information that can be a potential source for future intervention. This implies that the nodes connected to these ones are part of a much larger group and thus are part of a clique. In this specific case, we find that Node 5 is more neutral in nature and is connected to positive Node 8. So the original Node 4 and its connections are closely connected to a user providing positive support to this topic. This can then be compared with other nodes in the first layer such as Node 2. When this is done, we find that the other nodes that have clustering coefficient of 0, lack a connection to nodes with positive sentiment value thus indicating a lack of potential support as they experience their ACE events. Thus once this map is created, it allows us to use the clustering coefficients to identify isolated users who are experiencing ACEs with a lack of support.

Other measures can also be used to identify key individuals within these networks. The closeness centrality was measured for each node, which calculates a score proportional to the sum of all the shortest paths between all nodes. This measure can find the individuals who are in the best place to influence the entire network quickly, or 'broadcasters'. Within a relatively smaller network as the one shown in *Figure 2*, this measure can be a strong indication of the overall sentiment the network has towards ACEs. Nodes 4, 18, and 15 have the highest closeness centrality. These nodes talk about ACEs with a negative sentiment and since they are influential nodes, this is an indication that the network in *Figure 2* may be communicating and dealing with ACEs negatively. Interventional steps may therefore need to be taken.

Additionally as previously discussed, this network can be utilized to understand different groups and what makes them unique when dealing with ACEs. From a research perspective, the network once mapped significantly speeds the process of identifying relationships between nodes and thus the similarities between them. This proved to be true on initial exploration of this larger network but further analysis must be done. 

## 6 Conclusions

The goal of our project was to utilize a machine learning model in combination with network science approaches to identify useful information regarding Adverse Childhood Experiences from Twitter posts. We found that our model trained on titles from Reddit performed as expected on Twitter. With this in mind, we scraped tweets and built two networks. The first was our proof of concept and was limited in size. With the created network, we were able to prove viability for this method as it allowed us to realize two key findings. We were able to identify tightly clustered nodes and whether they have a positive or negative sphere of influence. This was one of the significant goals we had in our original aims and this was accomplished by the network. However, another significant focus of our work was on scalability and implementation. To accomplish this, we built a semi-automated pipeline to scrape tweets. This allowed us to build a more populated network to test our hypotheses. As shown in the results section, we were able to use clustering coefficients and closeness centrality scores to highlight specific key areas of the network map that require more specific attention. This information can then be relayed onto professionals while also being used to better understand the ongoing public incidents. The tools, machine learning models, and network science approaches we deployed allow us to, as we originally set out to, identify important information about ACEs quickly in a highly saturated and noise filled environment. This information can then be relayed to professionals.

Due to time constraints and other factors, we recognize that there are several limitations in our work so far. Thus, we have identified future steps to take this work further. First, is a need in improving the model performance. We explored a limited amount of potential data sources to train on. Other subreddits and non-reddit sources can potentially be used in the future to provide a more diverse training data set. Additionally, we noticed that due to training on Reddit and utilizing Twitter, there could be transferability issues. This mainly arises, due to the lack of context from tweets and thus more noise passes through the model. This could potentially also occur because a user on Reddit is 2x more likely to be male while a significant majority of the tweets discussing ACEs were female (Source). Another way to improve the performance of our model would be to increase the number of features utilized. It is feasible to pull various other numeric metrics about a user from Twitter such as number of followers, frequency of tweets, geographic location data, etc. These features need to be analyzed to determine if they can help improve the performance of the model and the network itself.  Along with an increase in features, larger networks with more nodes can be built and analyzed with the established pipelines. This will allow for a more thorough analysis on the benefits of the proposed networks science approaches and any additional methods that may prove useful. 
[[1]](#1)

## 7 Citations 
<a id="1">[1]</a> 
Dijkstra, E. W. (1968). o to statement considered harmful. Communications of the ACM, 11(3), 147-148.

menting **[state of the art machine learning models](https://www.semanticscholar.org/paper/Automatic-Diagnosis-of-Cardiac-Disease-from-and-Sundararajan-Moses/4df3bf3ec73df7f19b956e4e98c1cf7eaa620703)** 

**Contact Info**: Prathic Sundararajan - prathic44@gmail.com
